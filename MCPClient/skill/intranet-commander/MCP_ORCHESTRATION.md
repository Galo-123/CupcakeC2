# MCP 自动化审计与调度指南 (MCP Audit Orchestration)

本指南定义“内网安全审计指挥官”如何利用 MCP (Model Context Protocol) 工具作为执行层，在**授权范围内**完成基线采集、证据整理、整改清单生成与复测验证。它强调结构化输出、只读优先与可追溯。

## 1. 指挥官 + MCP：分工模型

*   **Skill 大脑（策略层）**：负责范围确认、风险建模、审计清单生成、证据要求与报告结构（依据 `SKILL.md` 与各手册）。
*   **MCP 工具（执行层）**：负责结构化采集与受控执行，例如列文件、采集配置、抓取日志摘要、输出机器可读的结果。

---

## 2. 工具调用决策树 (Tooling Decision Tree)

指挥官在检测到可用的 MCP 工具后，建议按以下顺序推进：

### 第一阶段：范围与基线 (Baseline)
*   **动作**：优先使用结构化只读能力（例如列进程、列服务、读取配置、列端口、导出策略摘要）。
*   **原则**：先建立“当前状态基线”，再讨论风险与整改；避免一上来做变更。

### 第二阶段：证据收集与归档 (Evidence)
*   **动作**：按发现项的证据要求采集最小必要数据，脱敏后归档。
*   **原则**：可复核与可复测优先；避免采集业务数据内容。

### 第三阶段：受控整改与复测 (Controlled Changes)
*   **动作**：仅在明确授权与变更窗口内，执行最小化整改动作，并在每一步后复测。
*   **原则**：任何会改变系统状态的动作必须显式提示，并先通过 `auditAction`（见 `index.js`）进行规则拦截与风险提示。

---

## 3. 指令模式 (Prompting & Orchestration)

推荐的 Prompt 结构：

> “检测到当前环境为 [环境名称]，可用 MCP 工具为 [工具列表]。我将按 `SKILL.md` 的审计/加固流程：先基线采集，再输出风险清单与整改 TODO，最后给出复测点。所有操作默认只读，任何变更会提前说明并二次确认。”

---

## 4. 审计约束与安全护栏 (Guardrails)

*   **只读优先**：优先采集证据与输出建议；变更类动作需审批与回滚预案。
*   **禁止对抗**：不关闭/绕过安全控制，不清理日志，不建立后门/持久化。
*   **异常拦截**：执行前先调用 `auditAction(cmd)` 做启发式拦截与风险提示（规则在 `index.js` 中维护）。
*   **节制与透明**：限制频率与范围，避免影响业务；过程记录可追溯，便于复核。

---

**决策状态**：等待 MCP 工具载入。一旦检测到活跃的 MCP Server，指挥官将从“建议输出模式”提升为“结构化采集与受控执行模式”。
