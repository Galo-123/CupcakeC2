import{_ as le,o as te,b as m,c as P,e as l,w as t,g as D,E as p,h as d,m as v,I as oe,J as ne,s as S,q as s,t as C,d as i,n as ae,B as W,u as y,N as se,S as de,U as ie,F as re,O as ue,P as pe,L as fe,V as me,W as _e,D as ye,C as ce}from"./index-DG_0wL7P.js";const be={class:"listener-manager"},ge={class:"card-header"},ve={class:"addr-code"},we={key:0},Ve={key:1,style:{color:"#666","font-style":"italic"}},ke={style:{"margin-bottom":"25px",display:"flex","justify-content":"center"}},xe={style:{flex:"1",display:"flex",gap:"8px"}},De={style:{flex:"1",display:"flex",gap:"8px"}},Se={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ce={__name:"ListenerManager",setup(Ne){const O=v([]),U=v(!1),w=v(!1),M=v(!1),V=v(!1),f=v("0.0.0.0:8081"),n=ce({bind_ip:"0.0.0.0",port:8081,note:"",protocol:"WebSocket",public_host:"",encrypt_mode:"AES-256-GCM",encrypt_key:"",encryption_salt:"",obfuscate_mode:"None",ns_domain:"",public_dns:"8.8.8.8:53",heartbeat_interval:10,max_retry:30}),k=async()=>{U.value=!0;try{const a=await D.get("/api/listeners");O.value=a.data}catch{p.error("无法同步监听器列表")}finally{U.value=!1}},z=()=>{w.value=!0,T(),E(),B(n.protocol)},B=a=>{a==="DNS"?f.value="0.0.0.0:53":a==="WebSocket"?f.value="0.0.0.0:8081":a==="TCP"?f.value="0.0.0.0:8888":["DOH","DOT"].includes(a)?f.value="0.0.0.0:443":f.value="0.0.0.0:8082"},T=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let r=0;r<32;r++)e+=a.charAt(Math.floor(Math.random()*a.length));n.encrypt_key=e,V.value=!0},E=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let e="";for(let r=0;r<6;r++)e+=a.charAt(Math.floor(Math.random()*a.length));n.encryption_salt=e},H=a=>({WebSocket:"success",TCP:"","KCP/UDP":"info",DNS:"warning",DOH:"danger",DOT:"danger"})[a]||"info",K=async()=>{const a=f.value.split(":");if(a.length===2?(n.bind_ip=a[0]||"0.0.0.0",n.port=parseInt(a[1])):isNaN(f.value)||(n.bind_ip="0.0.0.0",n.port=parseInt(f.value)),n.protocol==="DNS"&&!n.ns_domain){p.warning("DNS 协议必须配置 NS Domain");return}if(!n.encrypt_key){p.warning("必须设置通讯密钥 (Vkey)"),T();return}M.value=!0;try{await D.post("/api/listeners",{...n}),p.success(`监听器 [${n.protocol}] 已启动`),w.value=!1,k()}catch{p.error("启动失败")}finally{M.value=!1}},L=async a=>{try{await D.post(`/api/listeners/${a}/stop`),p.success("监听器已停止"),k()}catch{p.error("停止失败")}},q=async a=>{try{await D.post(`/api/listeners/${a}/start`),p.success("监听器已重新启动"),k()}catch{p.error("启动失败")}},F=a=>{ye.confirm("确定要删除该监听器吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await D.delete(`/api/listeners/${a}`),p.success("监听器已删除"),k()}catch{p.error("删除失败")}})};return te(k),(a,e)=>{const r=d("el-icon"),_=d("el-button"),b=d("el-table-column"),G=d("el-tag"),J=d("el-badge"),X=d("el-table"),j=d("el-card"),g=d("el-radio-button"),Q=d("el-radio-group"),N=d("el-divider"),c=d("el-input"),u=d("el-form-item"),A=d("el-input-number"),R=d("el-col"),Y=d("el-row"),x=d("el-option"),$=d("el-select"),Z=d("el-form"),h=d("el-dialog"),ee=oe("loading");return m(),P("div",be,[l(j,{shadow:"never"},{header:t(()=>[i("div",ge,[i("span",null,[l(r,{style:{"vertical-align":"middle","margin-right":"8px"}},{default:t(()=>[l(y(se))]),_:1}),e[15]||(e[15]=s(" 监听管理 ",-1))]),l(_,{type:"primary",icon:y(de),onClick:z},{default:t(()=>[...e[16]||(e[16]=[s("新增监听器",-1)])]),_:1},8,["icon"])])]),default:t(()=>[ne((m(),S(X,{data:O.value,style:{width:"100%"}},{default:t(()=>[l(b,{prop:"id",label:"ID",width:"100"}),l(b,{prop:"protocol",label:"核心协议",width:"130"},{default:t(o=>[l(G,{type:H(o.row.protocol),effect:"dark"},{default:t(()=>[s(C(o.row.protocol),1)]),_:2},1032,["type"])]),_:1}),l(b,{label:"监听地址",width:"200"},{default:t(o=>[i("code",ve,C(o.row.bind_ip||"0.0.0.0")+":"+C(o.row.port),1)]),_:1}),l(b,{prop:"note",label:"备注","min-width":"150","show-overflow-tooltip":""},{default:t(o=>[o.row.note?(m(),P("span",we,C(o.row.note),1)):(m(),P("span",Ve,"No Remark"))]),_:1}),l(b,{prop:"status",label:"状态",width:"120"},{default:t(o=>[l(J,{"is-dot":"",type:o.row.status==="Running"?"success":"danger"},{default:t(()=>[i("span",{style:ae({color:o.row.status==="Running"?"#00f2ea":"#ff4d4f"})},C(o.row.status),5)]),_:2},1032,["type"])]),_:1}),l(b,{label:"操作",width:"200",align:"center"},{default:t(o=>[o.row.status==="Stopped"||o.row.status==="Failed"?(m(),S(_,{key:0,link:"",style:{color:"#67c23a","font-weight":"600","font-size":"13px"},onClick:I=>q(o.row.id)},{default:t(()=>[...e[17]||(e[17]=[s(" 启动 ",-1)])]),_:1},8,["onClick"])):o.row.status==="Running"?(m(),S(_,{key:1,link:"",style:{color:"#e6a23c","font-weight":"600","font-size":"13px"},onClick:I=>L(o.row.id)},{default:t(()=>[...e[18]||(e[18]=[s(" 停止 ",-1)])]),_:1},8,["onClick"])):W("",!0),l(_,{link:"",style:{color:"#f56c6c","font-weight":"600","font-size":"13px","margin-left":"12px"},onClick:I=>F(o.row.id)},{default:t(()=>[...e[19]||(e[19]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,U.value]])]),_:1}),l(h,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=o=>w.value=o),title:"配置新监听器",width:"650px","destroy-on-close":"",class:"professional-dialog"},{footer:t(()=>[i("div",Se,[e[39]||(e[39]=i("div",{style:{color:"#999","font-size":"12px"}},"* 确保防火墙已放行对应端口及协议",-1)),i("div",null,[l(_,{onClick:e[13]||(e[13]=o=>w.value=!1)},{default:t(()=>[...e[37]||(e[37]=[s("取消",-1)])]),_:1}),l(_,{type:"primary",loading:M.value,onClick:K},{default:t(()=>[...e[38]||(e[38]=[s("启动监听器",-1)])]),_:1},8,["loading"])])])]),default:t(()=>[l(Z,{model:n,"label-width":"130px","label-position":"left"},{default:t(()=>[e[36]||(e[36]=i("div",{class:"form-section-title"},"通讯协议",-1)),i("div",ke,[l(Q,{modelValue:n.protocol,"onUpdate:modelValue":e[0]||(e[0]=o=>n.protocol=o),size:"large",onChange:B},{default:t(()=>[l(g,{label:"TCP"},{default:t(()=>[...e[20]||(e[20]=[s("TCP",-1)])]),_:1}),l(g,{label:"KCP/UDP"},{default:t(()=>[...e[21]||(e[21]=[s("UDP",-1)])]),_:1}),l(g,{label:"WebSocket"},{default:t(()=>[...e[22]||(e[22]=[s("WS",-1)])]),_:1}),l(g,{label:"DNS"},{default:t(()=>[...e[23]||(e[23]=[s("DNS",-1)])]),_:1}),l(g,{label:"DOH"},{default:t(()=>[...e[24]||(e[24]=[s("DOH",-1)])]),_:1}),l(g,{label:"DOT"},{default:t(()=>[...e[25]||(e[25]=[s("DOT",-1)])]),_:1})]),_:1},8,["modelValue"])]),l(N,{"content-position":"left"},{default:t(()=>[l(r,null,{default:t(()=>[l(y(ie))]),_:1}),e[26]||(e[26]=s(" 基础设置",-1))]),_:1}),l(u,{label:"监听地址",required:""},{default:t(()=>[l(c,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o),placeholder:"0.0.0.0:8080"},null,8,["modelValue"]),e[27]||(e[27]=i("div",{class:"tip"},"格式 IP:Port (例如 :80 或 0.0.0.0:443)",-1))]),_:1}),l(u,{label:"备注/别名"},{default:t(()=>[l(c,{modelValue:n.note,"onUpdate:modelValue":e[2]||(e[2]=o=>n.note=o),placeholder:"例如：北美中转节点-01"},null,8,["modelValue"])]),_:1}),l(u,{label:"Public Host"},{default:t(()=>[l(c,{modelValue:n.public_host,"onUpdate:modelValue":e[3]||(e[3]=o=>n.public_host=o),placeholder:"例如：c2.example.com"},null,8,["modelValue"]),e[28]||(e[28]=i("div",{class:"tip"},"Agent 迁移或重连时优先使用该地址。",-1))]),_:1}),n.protocol==="DNS"?(m(),P(re,{key:0},[l(N,{"content-position":"left"},{default:t(()=>[l(r,null,{default:t(()=>[l(y(ue))]),_:1}),e[29]||(e[29]=s(" DNS 专有配置",-1))]),_:1}),l(u,{label:"NS Domain",required:""},{default:t(()=>[l(c,{modelValue:n.ns_domain,"onUpdate:modelValue":e[4]||(e[4]=o=>n.ns_domain=o),placeholder:"ns1.example.com"},null,8,["modelValue"]),e[30]||(e[30]=i("div",{class:"tip"},"The domain delegated to this server (NS record target)",-1))]),_:1}),l(u,{label:"Public DNS"},{default:t(()=>[l(c,{modelValue:n.public_dns,"onUpdate:modelValue":e[5]||(e[5]=o=>n.public_dns=o),placeholder:"8.8.8.8:53"},null,8,["modelValue"]),e[31]||(e[31]=i("div",{class:"tip"},"Used for local testing or fallback",-1))]),_:1})],64)):W("",!0),l(N,{"content-position":"left"},{default:t(()=>[l(r,null,{default:t(()=>[l(y(pe))]),_:1}),e[32]||(e[32]=s(" 心跳与超时",-1))]),_:1}),l(Y,{gutter:20},{default:t(()=>[l(R,{span:12},{default:t(()=>[l(u,{label:"心跳间隔 (s)"},{default:t(()=>[l(A,{modelValue:n.heartbeat_interval,"onUpdate:modelValue":e[6]||(e[6]=o=>n.heartbeat_interval=o),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(R,{span:12},{default:t(()=>[l(u,{label:"最大重试次"},{default:t(()=>[l(A,{modelValue:n.max_retry,"onUpdate:modelValue":e[7]||(e[7]=o=>n.max_retry=o),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(N,{"content-position":"left"},{default:t(()=>[l(r,null,{default:t(()=>[l(y(fe))]),_:1}),e[33]||(e[33]=s(" 安全与加密",-1))]),_:1}),l(u,{label:"加密模式"},{default:t(()=>[l($,{modelValue:n.encrypt_mode,"onUpdate:modelValue":e[8]||(e[8]=o=>n.encrypt_mode=o),style:{width:"100%"},disabled:""},{default:t(()=>[l(x,{label:"AES-256-GCM (Enforced)",value:"AES-256-GCM"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"Vkey (Key)"},{default:t(()=>[i("div",xe,[l(c,{modelValue:n.encrypt_key,"onUpdate:modelValue":e[10]||(e[10]=o=>n.encrypt_key=o),type:V.value?"text":"password"},{suffix:t(()=>[l(r,{class:"cursor-pointer",onClick:e[9]||(e[9]=o=>V.value=!V.value)},{default:t(()=>[V.value?(m(),S(y(me),{key:0})):(m(),S(y(_e),{key:1}))]),_:1})]),_:1},8,["modelValue","type"]),l(_,{onClick:T},{default:t(()=>[...e[34]||(e[34]=[s("随机",-1)])]),_:1})])]),_:1}),l(u,{label:"Encryption Salt"},{default:t(()=>[i("div",De,[l(c,{modelValue:n.encryption_salt,"onUpdate:modelValue":e[11]||(e[11]=o=>n.encryption_salt=o),placeholder:"6-char random salt"},null,8,["modelValue"]),l(_,{onClick:E},{default:t(()=>[...e[35]||(e[35]=[s("随机",-1)])]),_:1})])]),_:1}),l(u,{label:"报文混淆"},{default:t(()=>[l($,{modelValue:n.obfuscate_mode,"onUpdate:modelValue":e[12]||(e[12]=o=>n.obfuscate_mode=o),style:{width:"100%"}},{default:t(()=>[l(x,{label:"None",value:"None"}),l(x,{label:"Base64 Encoding",value:"Base64"}),l(x,{label:"XOR Stream",value:"XOR"}),l(x,{label:"Junk Data Padding",value:"Junk"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ue=le(Ce,[["__scopeId","data-v-a43b844e"]]);export{Ue as default};
