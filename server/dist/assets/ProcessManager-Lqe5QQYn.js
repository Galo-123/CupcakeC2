import{g as T,_ as O,al as Q,o as Z,b as c,c as y,d as r,e as o,w as a,J as V,s as x,ag as W,ad as ee,t as p,B as C,q as u,n as te,E as _,m as k,h as i,I as se,j as oe,C as ne,u as v,am as le,p as E,A as ae,an as re,ao as ie}from"./index-DG_0wL7P.js";function ce(m){return T({url:"/api/processes/list",method:"get",params:{uuid:m}})}function ue(m){return T({url:"/api/processes/kill",method:"post",data:m})}const de={class:"proc-toolbar"},pe={class:"left-tools"},me={class:"noise-filter"},fe={class:"right-tools"},ge={class:"name-cell"},ye=["src"],_e={class:"p-name"},ve={key:0,class:"menu-header"},we={class:"status-bar"},he={key:0},be={__name:"ProcessManager",props:{clientId:{type:String,required:!0}},setup(m){const I=m,w=k(!1),f=k(""),S=k(!1),h=k([]),N=["360tray","360sd","ZhuDongFangYu","HipsDaemon","usysdiag","MsMpEng","NisSrv","kav","avp","mcshield","Sentinel","Cb","Falcon","Sysmon","defender","huorong"],U=["smss","csrss","wininit","winlogon","services","lsass","svchost","spoolsv","explorer","System Idle Process","System","Registry","Memory Compression","Interrupts"],P=t=>{if(!t)return"user";const e=t.toLowerCase();return N.some(s=>e.includes(s.toLowerCase()))?"security":U.some(s=>e.includes(s.toLowerCase()))?"system":"user"},Y=t=>{if(!t)return!1;const e=t.toUpperCase();return e==="SYSTEM"||e==="SERVICES"||e.includes("NT AUTHORITY")},g=async()=>{var t,e;if(I.clientId){w.value=!0;try{const s=await ce(I.clientId);s.data&&s.data.data&&(h.value=s.data.data,_.success({message:`获取成功: ${s.data.data.length} 个进程`,duration:1e3}))}catch(s){_.error("无法获取进程列表: "+(((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.error)||s.message))}finally{w.value=!1}}},M=oe(()=>{let t=h.value.map(e=>({...e,category:P(e.name)}));if(S.value&&(t=t.filter(e=>e.category!=="system")),f.value){const e=f.value.toLowerCase();t=t.filter(s=>s.name.toLowerCase().includes(e)||s.pid.toString().includes(e)||s.user&&s.user.toLowerCase().includes(e))}return t}),D=async t=>{var e,s;try{await ue({uuid:I.clientId,pid:t.pid}),_.success(`已发送结束指令: ${t.name}`),setTimeout(g,1500)}catch(R){_.error("操作失败: "+(((s=(e=R.response)==null?void 0:e.data)==null?void 0:s.error)||"未知错误"))}},z=({row:t})=>t.category==="security"?"security-row-highlight":t.category==="system"?"system-row-dim":"",L=t=>{const e=P(t);return e==="security"?"https://img.icons8.com/color/48/000000/shield.png":e==="system"?"https://img.icons8.com/color/48/000000/windows-shortcut-default.png":"https://img.icons8.com/color/48/000000/application-window.png"},B=t=>{const e=`Name: ${t.name}
PID: ${t.pid}
PPID: ${t.ppid}
User: ${t.user}
Arch: ${t.arch}`;navigator.clipboard.writeText(e),_.success("已复制详细信息")},l=ne({visible:!1,x:0,y:0,targetRow:null}),q=(t,e,s)=>{l.visible=!0,l.x=s.clientX,l.y=s.clientY,l.targetRow=t},A=t=>{l.visible||(l.visible=!0,l.x=t.clientX,l.y=t.clientY)},K=()=>{l.visible=!1};return Q(()=>{h.value.length===0&&g()}),Z(()=>{g()}),(t,e)=>{const s=i("el-icon"),R=i("el-input"),F=i("el-switch"),$=i("el-button"),H=i("el-button-group"),d=i("el-table-column"),b=i("el-tag"),X=i("el-popconfirm"),j=i("el-table"),G=i("el-divider"),J=se("loading");return c(),y("div",{class:"process-explorer",onClick:K},[r("div",de,[r("div",pe,[o(R,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),placeholder:"搜索 PID / 进程名称 / 用户...",clearable:"",class:"proc-search"},{prefix:a(()=>[o(s,null,{default:a(()=>[o(v(le))]),_:1})]),_:1},8,["modelValue"]),r("div",me,[e[4]||(e[4]=r("span",{class:"filter-label"},"隐藏系统进程:",-1)),o(F,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=n=>S.value=n),"active-color":"#13ce66"},null,8,["modelValue"])])]),r("div",fe,[o(H,null,{default:a(()=>[o($,{icon:v(E),onClick:g,loading:w.value},{default:a(()=>[...e[5]||(e[5]=[u("刷新列表 (Refresh)",-1)])]),_:1},8,["icon","loading"])]),_:1})])]),r("div",{class:"explorer-body",onContextmenu:W(A,["prevent"])},[V((c(),x(j,{data:M.value,style:{width:"100%"},height:"100%",class:"professional-proc-table","row-class-name":z,onRowContextmenu:q,"default-sort":{prop:"pid",order:"ascending"},size:"small",stripe:""},{default:a(()=>[o(d,{prop:"pid",label:"PID",width:"90",sortable:"",fixed:""}),o(d,{prop:"name",label:"映像名称 (Image Name)","min-width":"250",sortable:""},{default:a(n=>[r("div",ge,[r("img",{src:L(n.row.name),class:"proc-mini-icon"},null,8,ye),r("span",_e,p(n.row.name),1)])]),_:1}),o(d,{prop:"ppid",label:"父进程 ID (PPID)",width:"130",sortable:""}),o(d,{label:"分类",width:"130",align:"center"},{default:a(n=>[n.row.category==="security"?(c(),x(b,{key:0,type:"danger",effect:"dark",class:"type-tag"},{default:a(()=>[...e[6]||(e[6]=[u(" SECURITY ",-1)])]),_:1})):n.row.category==="system"?(c(),x(b,{key:1,type:"info",effect:"plain",class:"type-tag"},{default:a(()=>[...e[7]||(e[7]=[u(" SYSTEM ",-1)])]),_:1})):(c(),x(b,{key:2,type:"success",effect:"light",class:"type-tag"},{default:a(()=>[...e[8]||(e[8]=[u(" USER ",-1)])]),_:1}))]),_:1}),o(d,{prop:"user",label:"所属用户",width:"180",sortable:"","show-overflow-tooltip":""},{default:a(n=>[r("span",{class:ae({"system-user":Y(n.row.user)})},p(n.row.user||"Unknown"),3)]),_:1}),o(d,{prop:"arch",label:"架构",width:"90",align:"center"},{default:a(n=>[o(b,{size:"small",effect:"plain"},{default:a(()=>[u(p(n.row.arch||"x64"),1)]),_:2},1024)]),_:1}),o(d,{label:"操作",width:"100",align:"center",fixed:"right"},{default:a(n=>[o(X,{title:`确定强制结束进程 ${n.row.name} (PID: ${n.row.pid}) 吗?`,onConfirm:xe=>D(n.row),"confirm-button-text":"强制结束","confirm-button-type":"danger","cancel-button-text":"取消"},{reference:a(()=>[o($,{type:"danger",link:"",size:"small",class:"kill-link"},{default:a(()=>[...e[9]||(e[9]=[u("结束",-1)])]),_:1})]),_:1},8,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,w.value]])],32),V(r("div",{class:"custom-context-menu",style:te({left:l.x+"px",top:l.y+"px"})},[l.targetRow?(c(),y("div",ve,p(l.targetRow.name)+" ("+p(l.targetRow.pid)+") ",1)):C("",!0),r("div",{class:"menu-item",onClick:g},[o(s,null,{default:a(()=>[o(v(E))]),_:1}),e[10]||(e[10]=u(" 刷新列表 (Refresh) ",-1))]),o(G,{style:{margin:"4px 0"}}),l.targetRow?(c(),y("div",{key:1,class:"menu-item danger",onClick:e[2]||(e[2]=n=>D(l.targetRow))},[o(s,null,{default:a(()=>[o(v(re))]),_:1}),e[11]||(e[11]=u(" 强制结束任务 (Kill Task) ",-1))])):C("",!0),l.targetRow?(c(),y("div",{key:2,class:"menu-item",onClick:e[3]||(e[3]=n=>B(l.targetRow))},[o(s,null,{default:a(()=>[o(v(ie))]),_:1}),e[12]||(e[12]=u(" 复制详细信息 ",-1))])):C("",!0)],4),[[ee,l.visible]]),r("div",we,[r("span",null,"总进程数: "+p(h.value.length),1),f.value?(c(),y("span",he," | 筛选后: "+p(M.value.length),1)):C("",!0)])])}}},ke=O(be,[["__scopeId","data-v-27da4420"]]);export{ke as default};
