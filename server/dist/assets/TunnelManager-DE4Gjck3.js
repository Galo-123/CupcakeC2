import{_ as ne,o as oe,b as d,c as h,e as t,w as n,E as i,h as s,m as c,I as ae,J as le,s as v,d as u,t as m,q as r,u as f,K as se,B,P as re,p as de,L as ie,T as ue,M as pe,k as ce,C as _e,D as me}from"./index-DG_0wL7P.js";import{g as fe,s as U,d as I,a as ge}from"./socks-BFdVWVik.js";const ye={class:"tunnel-manager-global"},we={class:"card-header"},be={style:{"font-weight":"bold"}},ve={style:{"font-family":"'JetBrains Mono', monospace","font-weight":"bold",color:"#EBCB8B"}},ke={key:0,class:"agent-info-display"},xe={class:"agent-ip"},he={class:"agent-name"},Ve={class:"agent-id-hint"},Ce={key:1},Ae={class:"el-dropdown-link",style:{cursor:"pointer",color:"#409EFF",display:"flex","align-items":"center","justify-content":"center"}},Te={key:0,class:"auth-box"},Be={__name:"TunnelManager",setup(Ee){const V=c([]),C=c(!1),g=c(!1),A=c(!1),E=c(!1),S=c(""),T=c(""),a=_e({port:1080,type:"socks5",enableAuth:!1,username:"",password:""}),_=async()=>{C.value=!0;try{const l=await fe();l.data&&l.data.tunnels?V.value=l.data.tunnels:V.value=[]}catch{i.error("无法同步隧道数据")}finally{C.value=!1}},F=(l,e)=>{switch(l){case"start":N(e);break;case"stop":K(e.port);break;case"edit":O(e);break;case"delete":J(e.port);break}},N=async l=>{var e,p;try{await U({uuid:l.agent_id,port:String(l.port),type:l.type,username:l.username||"",password:l.password||""}),i.success("隧道已启动"),_()}catch(y){i.error(((p=(e=y.response)==null?void 0:e.data)==null?void 0:p.message)||"启动失败")}},K=async l=>{try{await ge({port:l}),i.success("隧道已关闭"),_()}catch{i.error("关闭失败")}},J=async l=>{try{await me.confirm("确定要彻底删除该隧道配置吗？","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await I({port:l}),i.success("删除成功"),_()}catch{}},O=l=>{E.value=!0,S.value=l.agent_id,T.value=l.port,a.port=parseInt(l.port),a.type=l.type||"socks5",a.username=l.username||"",a.password=l.password||"",a.enableAuth=!!(a.username&&a.password),g.value=!0},j=async()=>{var l,e;if(a.enableAuth&&(!a.username||!a.password)){i.warning("启用认证时，用户名和密码不能为空"),A.value=!1;return}try{await U({uuid:S.value,port:String(a.port),type:a.type,username:a.enableAuth?a.username:"",password:a.enableAuth?a.password:""}),String(a.port)!==T.value&&await I({port:T.value}),i.success("配置已更新并生效"),g.value=!1,_()}catch(p){i.error(((e=(l=p.response)==null?void 0:l.data)==null?void 0:e.message)||"保存失败")}finally{A.value=!1}};return oe(()=>{_()}),(l,e)=>{const p=s("el-icon"),y=s("el-button"),w=s("el-table-column"),q=s("router-link"),k=s("el-tag"),x=s("el-dropdown-item"),z=s("el-dropdown-menu"),H=s("el-dropdown"),L=s("el-table"),R=s("el-card"),$=s("el-input-number"),b=s("el-form-item"),D=s("el-radio-button"),G=s("el-radio-group"),Q=s("el-divider"),W=s("el-switch"),P=s("el-input"),M=s("el-col"),X=s("el-row"),Y=s("el-form"),Z=s("el-dialog"),ee=ae("loading");return d(),h("div",ye,[t(R,{shadow:"never"},{header:n(()=>[u("div",we,[u("span",be,[t(p,{style:{"vertical-align":"middle","margin-right":"8px"}},{default:n(()=>[t(f(re))]),_:1}),e[7]||(e[7]=r(" 全局隧道监控 ",-1))]),t(y,{type:"primary",icon:f(de),circle:"",onClick:_},null,8,["icon"])])]),default:n(()=>[le((d(),v(L,{data:V.value,style:{width:"100%"},"header-cell-style":{background:"rgba(136, 192, 208, 0.05)",color:"#81A1C1"}},{default:n(()=>[t(w,{label:"监听地址","min-width":"150"},{default:n(o=>[u("span",ve," 0.0.0.0:"+m(o.row.port),1)]),_:1}),t(w,{label:"关联终端 (对方主机地址 : 主机名)","min-width":"250"},{default:n(o=>[o.row.agent_ip?(d(),h("div",ke,[t(q,{to:"/client/"+o.row.agent_id,class:"agent-link-wrapper"},{default:n(()=>[u("span",xe,m(o.row.agent_ip),1),e[8]||(e[8]=u("span",{class:"agent-sep"}," : ",-1)),u("span",he,m(o.row.agent_name),1)]),_:2},1032,["to"]),u("div",Ve,"ID: "+m(o.row.agent_id),1)])):(d(),h("div",Ce,[t(k,{type:"info"},{default:n(()=>[r("离线或未知 ("+m(o.row.agent_id.substring(0,8))+"...)",1)]),_:2},1024)]))]),_:1}),t(w,{label:"协议",width:"100"},{default:n(o=>[t(k,{type:o.row.type==="http"?"warning":"success",effect:"light"},{default:n(()=>[r(m(o.row.type?o.row.type.toUpperCase():"SOCKS5"),1)]),_:2},1032,["type"])]),_:1}),t(w,{label:"状态",width:"100"},{default:n(o=>[o.row.status==="running"?(d(),v(k,{key:0,type:"success",effect:"dark"},{default:n(()=>[...e[9]||(e[9]=[r("运行中",-1)])]),_:1})):(d(),v(k,{key:1,type:"danger",effect:"dark"},{default:n(()=>[...e[10]||(e[10]=[r("已停止",-1)])]),_:1}))]),_:1}),t(w,{label:"操作",width:"120",align:"center",fixed:"right"},{default:n(o=>[t(H,{trigger:"click",onCommand:te=>F(te,o.row)},{dropdown:n(()=>[t(z,null,{default:n(()=>[o.row.status!=="running"?(d(),v(x,{key:0,command:"start",icon:"VideoPlay",style:{color:"#67C23A"}},{default:n(()=>[...e[12]||(e[12]=[r(" 启动 ",-1)])]),_:1})):B("",!0),o.row.status==="running"?(d(),v(x,{key:1,command:"stop",icon:"VideoPause",style:{color:"#E6A23C"}},{default:n(()=>[...e[13]||(e[13]=[r(" 停止 ",-1)])]),_:1})):B("",!0),t(x,{command:"edit",icon:"Edit",divided:""},{default:n(()=>[...e[14]||(e[14]=[r(" 编辑 ",-1)])]),_:1}),t(x,{command:"delete",icon:"Delete",style:{color:"#F56C6C"}},{default:n(()=>[...e[15]||(e[15]=[r(" 删除 ",-1)])]),_:1})]),_:2},1024)]),default:n(()=>[u("span",Ae,[e[11]||(e[11]=u("span",{style:{"margin-right":"4px"}},"管理",-1)),t(p,null,{default:n(()=>[t(f(se))]),_:1})])]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[ee,C.value]])]),_:1}),t(Z,{title:E.value?"编辑隧道配置":"启动隧道",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o),width:"480px","destroy-on-close":"",center:""},{footer:n(()=>[t(y,{onClick:e[5]||(e[5]=o=>g.value=!1)},{default:n(()=>[...e[19]||(e[19]=[r("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:j,loading:A.value},{default:n(()=>[...e[20]||(e[20]=[r("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(Y,{"label-position":"top"},{default:n(()=>[t(b,{label:"监听端口 (VPS Port)"},{default:n(()=>[t($,{modelValue:a.port,"onUpdate:modelValue":e[0]||(e[0]=o=>a.port=o),min:1,max:65535,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(b,{label:"隧道协议 (Protocol)"},{default:n(()=>[t(G,{modelValue:a.type,"onUpdate:modelValue":e[1]||(e[1]=o=>a.type=o),style:{width:"100%",display:"flex"}},{default:n(()=>[t(D,{label:"socks5",style:{flex:"1","text-align":"center"}},{default:n(()=>[...e[16]||(e[16]=[r("SOCKS5",-1)])]),_:1}),t(D,{label:"http",style:{flex:"1","text-align":"center"}},{default:n(()=>[...e[17]||(e[17]=[r("HTTP",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Q,{"content-position":"center"},{default:n(()=>[t(p,{style:{"vertical-align":"middle","margin-right":"5px"}},{default:n(()=>[t(f(ie))]),_:1}),e[18]||(e[18]=r(" 安全设置 (Security) ",-1))]),_:1}),t(b,{label:"身份验证 (Authentication)"},{default:n(()=>[t(W,{modelValue:a.enableAuth,"onUpdate:modelValue":e[2]||(e[2]=o=>a.enableAuth=o),"active-text":"启用账号密码","inactive-text":"无认证",style:{"--el-switch-on-color":"#13ce66"}},null,8,["modelValue"])]),_:1}),t(ue,{name:"el-zoom-in-top"},{default:n(()=>[a.enableAuth?(d(),h("div",Te,[t(X,{gutter:15},{default:n(()=>[t(M,{span:12},{default:n(()=>[t(b,{label:"用户名"},{default:n(()=>[t(P,{modelValue:a.username,"onUpdate:modelValue":e[3]||(e[3]=o=>a.username=o),placeholder:"admin","prefix-icon":f(pe)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),t(M,{span:12},{default:n(()=>[t(b,{label:"密码"},{default:n(()=>[t(P,{modelValue:a.password,"onUpdate:modelValue":e[4]||(e[4]=o=>a.password=o),type:"password","show-password":"",placeholder:"password","prefix-icon":f(ce)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1})]),_:1})])):B("",!0)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])}}},Pe=ne(Be,[["__scopeId","data-v-213496ca"]]);export{Pe as default};
