import{_ as E,o as $,a as B,a8 as F,b as y,c as U,d as s,t as p,e as t,w as l,g as V,E as T,m as h,j as x,h as d,H as q,a9 as A,q as O,u as f,N as j,aa as H,P as J,ab as K,ac as L,T as z,s as G,v as Q}from"./index-DG_0wL7P.js";const X={class:"client-detail"},Y={class:"top-header"},Z={class:"header-left"},ee={class:"subtitle"},te={class:"header-right"},ne={class:"main-layout"},le={class:"left-sidebar"},se={class:"right-content"},oe={__name:"ClientDetail",setup(ae){const m=A(),v=q(),i=x(()=>m.params.id),c=h(null),I=x(()=>{const n=m.name;return n==="ClientTerminals"?"terminals":n==="ClientFiles"?"files":n==="ClientTunnels"?"tunnels":n==="ClientProcesses"?"processes":n==="ClientPlugins"?"plugins":"terminals"}),D=n=>{const e={terminals:"ClientTerminals",files:"ClientFiles",tunnels:"ClientTunnels",processes:"ClientProcesses",plugins:"ClientPlugins"};v.push({name:e[n],params:{id:i.value}})},M=()=>({ClientTerminals:"终端",ClientFiles:"文件管理",ClientTunnels:"隧道管理",ClientProcesses:"进程管理",ClientPlugins:"插件与后渗透"})[m.name]||"终端",k=async()=>{try{const e=(await V.get("/api/clients")).data.find(r=>r.uuid===i.value);e?c.value=e:(T.error("客户端不存在"),v.push("/clients"))}catch{T.error("无法获取客户端信息")}},a=h(null),C=h(null);let g=null;const P=()=>{const n=`terminal_history_${i.value}`;localStorage.removeItem(n),console.log("[ClientDetail] Cleared terminal history for",i.value),v.push("/clients")},N=()=>{const n=window.location.protocol==="https:"?"wss:":"ws:",e=window.location.host,r=localStorage.getItem("cupcake_token"),u=`${n}//${e}/api/shell/${i.value}?token=${encodeURIComponent(r)}`;console.log("[ClientDetail] Connecting to WebSocket:",u),a.value=new WebSocket(u),a.value.onopen=()=>{console.log("[ClientDetail] WebSocket Connected"),g=setInterval(()=>{var o;((o=a.value)==null?void 0:o.readyState)===WebSocket.OPEN&&a.value.send(JSON.stringify({type:"ping"}))},3e4)},a.value.onmessage=o=>{var _;(_=C.value)!=null&&_.handleSocketMessage&&C.value.handleSocketMessage(o)},a.value.onclose=()=>{console.log("[ClientDetail] WebSocket Closed")},a.value.onerror=o=>{console.error("[ClientDetail] WebSocket Error:",o)}};return $(()=>{k(),N()}),B(()=>{g&&clearInterval(g),a.value&&a.value.close()}),F(i,()=>{k()}),(n,e)=>{var S,w,b;const r=d("el-button"),u=d("el-icon"),o=d("el-menu-item"),_=d("el-menu"),R=d("router-view");return y(),U("div",X,[s("div",Y,[s("div",Z,[s("h1",null,p(M()),1),s("span",ee,p(((S=c.value)==null?void 0:S.hostname)||i.value)+" | "+p(((w=c.value)==null?void 0:w.ip)||"N/A")+" | "+p(((b=c.value)==null?void 0:b.username)||"N/A"),1)]),s("div",te,[t(r,{onClick:P},{default:l(()=>[...e[0]||(e[0]=[O("返回列表",-1)])]),_:1})])]),s("div",ne,[s("div",le,[t(_,{"default-active":I.value,onSelect:D,class:"sidebar-menu"},{default:l(()=>[t(o,{index:"terminals"},{default:l(()=>[t(u,null,{default:l(()=>[t(f(j))]),_:1}),e[1]||(e[1]=s("span",null,"终端",-1))]),_:1}),t(o,{index:"files"},{default:l(()=>[t(u,null,{default:l(()=>[t(f(H))]),_:1}),e[2]||(e[2]=s("span",null,"文件管理",-1))]),_:1}),t(o,{index:"tunnels"},{default:l(()=>[t(u,null,{default:l(()=>[t(f(J))]),_:1}),e[3]||(e[3]=s("span",null,"隧道管理",-1))]),_:1}),t(o,{index:"processes"},{default:l(()=>[t(u,null,{default:l(()=>[t(f(K))]),_:1}),e[4]||(e[4]=s("span",null,"进程管理",-1))]),_:1}),t(o,{index:"plugins"},{default:l(()=>[t(u,null,{default:l(()=>[t(f(L))]),_:1}),e[5]||(e[5]=s("span",null,"插件/工具",-1))]),_:1})]),_:1},8,["default-active"])]),s("div",se,[t(R,null,{default:l(({Component:W})=>[t(z,{name:"fade",mode:"out-in"},{default:l(()=>[(y(),G(Q(W),{"client-id":i.value,"client-info":c.value,socket:a.value,ref_key:"childRef",ref:C},null,8,["client-id","client-info","socket"]))]),_:2},1024)]),_:1})])])])}}},ue=E(oe,[["__scopeId","data-v-786c09d9"]]);export{ue as default};
