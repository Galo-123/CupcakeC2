import{_ as ee,o as te,b as u,c as g,d as n,e as s,w as a,t as p,g as w,E as L,h as d,m as h,j as B,C as U,I as se,u as f,ac as ae,N as le,q as c,ap as ne,a3 as oe,am as ie,J as N,s as D,B as R,F as re,r as de,A as ce,aq as ue,a0 as pe,Z as _e}from"./index-DG_0wL7P.js";const fe={class:"plugin-manager"},me={class:"header-banner"},ge={class:"banner-stat"},ve={class:"stat-info"},ye={class:"value"},we={class:"banner-stat active"},be={class:"stat-info"},ke={class:"value"},he={class:"card-header"},Ce={class:"plugin-name-cell"},Ie={class:"name"},Ve={class:"card-header"},xe={class:"task-list"},Le={class:"task-info"},De={class:"task-type"},Pe={class:"task-id"},qe={class:"task-time"},Te={class:"task-actions"},$e={class:"opsec-tip"},Se={class:"result-viewer"},Be={key:0},Ue={__name:"PluginManager",props:{clientId:String,clientInfo:Object},setup(j){const v=j,b=h(""),C=h([]),k=h([]),I=h(!1),E=B(()=>C.value.filter(t=>{var y;if(!(t.name.toLowerCase().includes(b.value.toLowerCase())||t.type.toLowerCase().includes(b.value.toLowerCase())))return!1;if(!((y=v.clientInfo)!=null&&y.os))return!0;const i=v.clientInfo.os.toLowerCase(),_=(t.required_os||"").toLowerCase();return _&&_!=="multi"&&_!=="any"?i.includes(_)||_.includes(i):!0})),M=B(()=>k.value.filter(t=>t.status==="pending")),r=U({visible:!1,loading:!1,args:"",selectedPlugin:null}),o=U({visible:!1,loading:!1,taskId:"",content:""}),O=async()=>{try{const t=await w.get("/api/plugins");C.value=t.data}catch{L.error("无法获取插件列表")}},V=async()=>{I.value=!0;try{const t=await w.get(`/api/resp?uuid=${v.clientId}`),e=await w.get(`/api/clients/history/${v.clientId}`);k.value=e.data.slice(0,10)}catch(t){console.error("Logs fetch failed",t)}finally{I.value=!1}},z=t=>{r.selectedPlugin=t,r.args="",r.visible=!0},A=async()=>{var t,e;if(r.selectedPlugin){r.loading=!0;try{const i=await w.post("/api/plugins/run",{agent_id:v.clientId,plugin_id:r.selectedPlugin.id,args:r.args});L.success(`指令已下发! 任务ID: ${i.data.task_id}`),r.visible=!1,setTimeout(V,1e3)}catch(i){L.error(((e=(t=i.response)==null?void 0:t.data)==null?void 0:e.error)||"执行失败")}finally{r.loading=!1}}},F=async t=>{o.taskId=t.req_id,o.content="",o.visible=!0,o.loading=!0;try{const e=await w.get(`/api/plugins/result/${t.req_id}`);o.content=e.data}catch{o.content="无法加载日志，可能文件已被清理或尚未生成。"}finally{o.loading=!1}},J=()=>{const t=new Blob([o.content],{type:"text/plain"}),e=window.URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=`task_${o.taskId}.txt`,i.click()},X=t=>t==="execute-assembly"?"warning":t==="memfd-exec"?"success":t==="inject-shellcode"?"danger":"",Z=t=>t==="completed"?"success":t==="pending"?"info":t==="failed"?"danger":"",G=t=>t?new Date(t).toLocaleTimeString():"-";return te(()=>{O(),V()}),(t,e)=>{const i=d("el-icon"),_=d("el-input"),y=d("el-tag"),x=d("el-table-column"),m=d("el-button"),H=d("el-table"),P=d("el-card"),q=d("el-col"),T=d("el-empty"),K=d("el-row"),Q=d("el-form-item"),W=d("el-form"),$=d("el-dialog"),S=se("loading");return u(),g("div",fe,[n("div",me,[n("div",ge,[s(i,null,{default:a(()=>[s(f(ae))]),_:1}),n("div",ve,[e[6]||(e[6]=n("span",{class:"label"},"可用插件",-1)),n("span",ye,p(C.value.length),1)])]),n("div",we,[s(i,null,{default:a(()=>[s(f(le))]),_:1}),n("div",be,[e[7]||(e[7]=n("span",{class:"label"},"正在执行",-1)),n("span",ke,p(M.value.length),1)])])]),s(K,{gutter:20},{default:a(()=>[s(q,{span:14},{default:a(()=>[s(P,{shadow:"never",class:"card-container"},{header:a(()=>[n("div",he,[n("span",null,[s(i,null,{default:a(()=>[s(f(oe))]),_:1}),e[8]||(e[8]=c(" 插件库",-1))]),s(_,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),placeholder:"搜索插件...",clearable:"",class:"search-input","prefix-icon":f(ie)},null,8,["modelValue","prefix-icon"])])]),default:a(()=>[s(H,{data:E.value,style:{width:"100%"},height:"calc(70vh - 100px)"},{default:a(()=>[s(x,{label:"插件名称",width:"200"},{default:a(l=>[n("div",Ce,[n("span",Ie,p(l.row.name),1),s(y,{size:"small",type:X(l.row.type)},{default:a(()=>[c(p(l.row.type),1)]),_:2},1032,["type"])])]),_:1}),s(x,{prop:"description",label:"描述","show-overflow-tooltip":""}),s(x,{label:"操作",width:"100",align:"center"},{default:a(l=>[s(m,{type:"primary",circle:"",icon:f(ne),onClick:Y=>z(l.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),s(q,{span:10},{default:a(()=>[s(P,{shadow:"never",class:"card-container"},{header:a(()=>[n("div",Ve,[n("span",null,[s(i,null,{default:a(()=>[s(f(ue))]),_:1}),e[9]||(e[9]=c(" 执行历史 (最近 10 条)",-1))]),s(m,{link:"",type:"primary",onClick:V},{default:a(()=>[...e[10]||(e[10]=[c("刷新",-1)])]),_:1})])]),default:a(()=>[N((u(),g("div",xe,[k.value.length===0?(u(),D(T,{key:0,description:"暂无执行记录"})):R("",!0),(u(!0),g(re,null,de(k.value,l=>(u(),g("div",{key:l.req_id,class:ce(["task-item",l.status])},[n("div",Le,[n("span",De,p(l.type),1),n("span",Pe,"ID: "+p(l.req_id),1),n("span",qe,p(G(l.created_at)),1)]),n("div",Te,[s(y,{size:"small",type:Z(l.status)},{default:a(()=>[c(p(l.status),1)]),_:2},1032,["type"]),l.status==="completed"?(u(),D(m,{key:0,link:"",type:"primary",onClick:Y=>F(l)},{default:a(()=>[...e[11]||(e[11]=[c("查看回显",-1)])]),_:1},8,["onClick"])):R("",!0)])],2))),128))])),[[S,I.value]])]),_:1})]),_:1})]),_:1}),s($,{modelValue:r.visible,"onUpdate:modelValue":e[3]||(e[3]=l=>r.visible=l),title:"运行插件配置",width:"500px"},{footer:a(()=>[s(m,{onClick:e[2]||(e[2]=l=>r.visible=!1)},{default:a(()=>[...e[13]||(e[13]=[c("取消",-1)])]),_:1}),s(m,{type:"primary",loading:r.loading,onClick:A},{default:a(()=>[...e[14]||(e[14]=[c("立即执行",-1)])]),_:1},8,["loading"])]),default:a(()=>[s(W,{"label-position":"top"},{default:a(()=>[s(Q,{label:"命令行参数 (Arguments)"},{default:a(()=>[s(_,{modelValue:r.args,"onUpdate:modelValue":e[1]||(e[1]=l=>r.args=l),type:"textarea",rows:3,placeholder:"例如: -h 192.168.1.1 --port 445 (如果是注入，请输入 PID)"},null,8,["modelValue"])]),_:1}),n("div",$e,[s(i,null,{default:a(()=>[s(f(pe))]),_:1}),e[12]||(e[12]=c(" 提示: 该插件将远程加载到内存中执行，不会在目标磁盘产生临时文件。 ",-1))])]),_:1})]),_:1},8,["modelValue"]),s($,{modelValue:o.visible,"onUpdate:modelValue":e[5]||(e[5]=l=>o.visible=l),title:"任务回显: "+o.taskId,width:"80%",top:"5vh"},{footer:a(()=>[s(m,{onClick:e[4]||(e[4]=l=>o.visible=!1)},{default:a(()=>[...e[15]||(e[15]=[c("关闭",-1)])]),_:1}),s(m,{type:"primary",icon:f(_e),onClick:J},{default:a(()=>[...e[16]||(e[16]=[c("下载 TXT",-1)])]),_:1},8,["icon"])]),default:a(()=>[N((u(),g("div",Se,[o.content?(u(),g("pre",Be,p(o.content),1)):(u(),D(T,{key:1,description:"暂无输出或正在加载..."}))])),[[S,o.loading]])]),_:1},8,["modelValue","title"])])}}},Re=ee(Ue,[["__scopeId","data-v-06313dbc"]]);export{Re as default};
