import{_ as W,o as X,b as i,c as N,e as t,w as l,E as p,h as a,m as c,I as Y,J as Z,s as g,q as s,t as h,d as v,B as C,u as m,P as ee,p as te,S as le,L as ne,T as oe,M as ae,k as se,j as re,C as ue}from"./index-DG_0wL7P.js";import{g as ie,a as de,s as pe,d as ce}from"./socks-BFdVWVik.js";const me={class:"tunnel-manager"},fe={class:"card-header"},_e={key:0,class:"auth-box"},ye={class:"dialog-footer"},ge={__name:"TunnelManager",props:{clientId:{type:String,required:!0},clientInfo:{type:Object,default:null}},setup(D){const S=D,k=c([]),f=c(!1),w=c(!1),T=c(!1),d=c(!1),A=c(""),P=re(()=>k.value.filter(r=>r.agent_id===S.clientId)),n=ue({port:1080,type:"socks5",enableAuth:!1,username:"",password:""}),b=async()=>{T.value=!0;try{const r=await ie();r.data&&r.data.tunnels?k.value=r.data.tunnels:k.value=[]}catch{p.warning("无法同步隧道列表")}finally{T.value=!1}},U=()=>{d.value=!1,n.port=1080,n.type="socks5",n.enableAuth=!1,n.username="",n.password="",f.value=!0},O=async()=>{var r,e;if(w.value=!0,n.enableAuth&&(!n.username||!n.password)){p.warning("启用认证时，用户名和密码不能为空"),w.value=!1;return}try{await pe({uuid:S.clientId,port:String(n.port),type:n.type,username:n.enableAuth?n.username:"",password:n.enableAuth?n.password:""}),d.value&&String(n.port)!==A.value&&await ce({port:A.value}),p.success(d.value?"配置已更新":`${n.type.toUpperCase()} 代理已启动`),f.value=!1,b()}catch(V){const u=((e=(r=V.response)==null?void 0:r.data)==null?void 0:e.message)||"操作失败";p.error(u)}finally{w.value=!1}},H=async r=>{try{await de({port:r}),p.success("隧道已停止"),b()}catch{p.error("停止失败")}};return X(()=>{b()}),(r,e)=>{const V=a("el-icon"),u=a("el-button"),x=a("el-tag"),_=a("el-table-column"),K=a("el-table"),$=a("el-empty"),j=a("el-card"),I=a("el-alert"),q=a("el-input-number"),y=a("el-form-item"),B=a("el-radio-button"),z=a("el-radio-group"),L=a("el-divider"),J=a("el-switch"),E=a("el-input"),M=a("el-col"),F=a("el-row"),G=a("el-form"),Q=a("el-dialog"),R=Y("loading");return i(),N("div",me,[t(j,{shadow:"never"},{header:l(()=>[v("div",fe,[v("span",null,[t(V,{style:{"vertical-align":"middle","margin-right":"5px"}},{default:l(()=>[t(m(ee))]),_:1}),e[7]||(e[7]=s(" 内网隧道 (Client Tunnels) ",-1))]),v("div",null,[t(u,{icon:m(te),circle:"",onClick:b,style:{"margin-right":"10px"}},null,8,["icon"]),t(u,{type:"primary",icon:m(le),onClick:U},{default:l(()=>[...e[8]||(e[8]=[s("新建隧道",-1)])]),_:1},8,["icon"])])])]),default:l(()=>[Z((i(),g(K,{data:P.value,style:{width:"100%"},"empty-text":"暂无活动隧道"},{default:l(()=>[t(_,{label:"协议",width:"100"},{default:l(o=>[t(x,{type:o.row.type==="http"?"warning":"success",effect:"dark"},{default:l(()=>[s(h(o.row.type?o.row.type.toUpperCase():"SOCKS5"),1)]),_:2},1032,["type"])]),_:1}),t(_,{label:"监听地址",width:"180"},{default:l(o=>[t(x,{type:"info",class:"addr-code"},{default:l(()=>[s("0.0.0.0:"+h(o.row.port),1)]),_:2},1024)]),_:1}),t(_,{label:"转发目标","min-width":"200"},{default:l(()=>[...e[9]||(e[9]=[v("span",{style:{color:"#606266"}},"动态转发 (Dynamic)",-1)])]),_:1}),t(_,{label:"状态",width:"100"},{default:l(o=>[o.row.status==="running"?(i(),g(x,{key:0,type:"success"},{default:l(()=>[...e[10]||(e[10]=[s("运行中",-1)])]),_:1})):(i(),g(x,{key:1,type:"danger"},{default:l(()=>[...e[11]||(e[11]=[s("已停止",-1)])]),_:1}))]),_:1}),t(_,{label:"操作",width:"100",align:"center"},{default:l(o=>[t(u,{type:"danger",size:"small",onClick:ve=>H(o.row.port)},{default:l(()=>[...e[12]||(e[12]=[s("停止",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,T.value]]),P.value.length===0?(i(),g($,{key:0,description:"该客户端暂无活动隧道"},{default:l(()=>[t(u,{type:"primary",onClick:U},{default:l(()=>[...e[13]||(e[13]=[s("开启第一个隧道",-1)])]),_:1})]),_:1})):C("",!0)]),_:1}),t(Q,{title:d.value?"编辑网络隧道":"新建网络隧道 (Network Tunnel)",modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),width:"480px","destroy-on-close":"",center:""},{footer:l(()=>[v("span",ye,[t(u,{onClick:e[5]||(e[5]=o=>f.value=!1)},{default:l(()=>[...e[17]||(e[17]=[s("取 消",-1)])]),_:1}),t(u,{type:"primary",onClick:O,loading:w.value},{default:l(()=>[s(h(d.value?"保 存":"立即开启"),1)]),_:1},8,["loading"])])]),default:l(()=>[d.value?C("",!0):(i(),g(I,{key:0,title:"功能说明",type:"info",closable:!1,"show-icon":"",description:"在服务端 (VPS) 启动一个监听端口，将流量透明转发至该终端所在的内网环境。适用于内网渗透、扫描等场景。",style:{"margin-bottom":"20px"}})),t(G,{"label-position":"top"},{default:l(()=>[t(y,{label:"服务端监听端口 (VPS Port)"},{default:l(()=>[t(q,{modelValue:n.port,"onUpdate:modelValue":e[0]||(e[0]=o=>n.port=o),min:1,max:65535,"controls-position":"right",style:{width:"100%"},placeholder:"例如: 1080"},null,8,["modelValue"])]),_:1}),t(y,{label:"隧道协议 (Protocol)"},{default:l(()=>[t(z,{modelValue:n.type,"onUpdate:modelValue":e[1]||(e[1]=o=>n.type=o),style:{width:"100%",display:"flex"}},{default:l(()=>[t(B,{label:"socks5",style:{flex:"1","text-align":"center"}},{default:l(()=>[...e[14]||(e[14]=[s(" SOCKS5 ",-1)])]),_:1}),t(B,{label:"http",style:{flex:"1","text-align":"center"}},{default:l(()=>[...e[15]||(e[15]=[s(" HTTP / HTTPS ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(L,{"content-position":"center"},{default:l(()=>[t(V,{style:{"vertical-align":"middle","margin-right":"5px"}},{default:l(()=>[t(m(ne))]),_:1}),e[16]||(e[16]=s(" 安全设置 (Security) ",-1))]),_:1}),t(y,{label:"身份验证 (Authentication)"},{default:l(()=>[t(J,{modelValue:n.enableAuth,"onUpdate:modelValue":e[2]||(e[2]=o=>n.enableAuth=o),"active-text":"启用账号密码 (Enable)","inactive-text":"无认证 (Public)",style:{"--el-switch-on-color":"#13ce66"}},null,8,["modelValue"])]),_:1}),t(oe,{name:"el-zoom-in-top"},{default:l(()=>[n.enableAuth?(i(),N("div",_e,[t(F,{gutter:15},{default:l(()=>[t(M,{span:12},{default:l(()=>[t(y,{label:"用户名 (Username)"},{default:l(()=>[t(E,{modelValue:n.username,"onUpdate:modelValue":e[3]||(e[3]=o=>n.username=o),placeholder:"例如: admin","prefix-icon":m(ae)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),t(M,{span:12},{default:l(()=>[t(y,{label:"密码 (Password)"},{default:l(()=>[t(E,{modelValue:n.password,"onUpdate:modelValue":e[4]||(e[4]=o=>n.password=o),type:"password","show-password":"",placeholder:"设置强密码","prefix-icon":m(se)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1})]),_:1}),t(I,{title:"提示：认证配置将同时应用于 SOCKS5/HTTP 代理。",type:"info",closable:!1,"show-icon":""})])):C("",!0)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])}}},Ve=W(ge,[["__scopeId","data-v-44dec173"]]);export{Ve as default};
