# 持久化风险面治理与检测指南 (Defensive)

本指南从防守视角梳理常见“持久化”风险面，提供审计检查项、可观测证据与治理建议，用于降低攻击者长期驻留的可能性。内容避免提供实现细节。

## 1. 原则 (Principles)

*   **以治理为主**：优先减少高权限入口（特权组、服务账号、远程管理通道），再补检测与告警。
*   **变更可追溯**：对自启动/任务/服务/关键注册表等入口建立变更审批与可追溯记录。
*   **基线对比**：建立“已知良好基线”，持续做差异化监测与复核。

---

## 2. Windows 常见风险面 (Review Points)

*   **自启动入口**：启动项、计划任务、服务、驱动、组策略脚本等（按组织基线梳理）。
*   **配置劫持面**：应用加载链与组件注册、脚本宿主配置等（关注“谁能写、写到哪里、何时生效”）。
*   **远程管理通道**：RDP、WinRM、远程服务管理权限的收敛与审计。
*   **证据点**：对象创建/修改时间、对应配置导出片段、变更审批记录、账号与对象变更相关事件日志。

治理建议：
*   最小权限与签名/白名单策略（如 WDAC/AppLocker，按组织可用性评估）。
*   计划任务/服务/启动项变更审批与监控；对关键路径设置完整性监控（FIM）。
*   管理工作站隔离与分权运维，减少高权限账号在业务终端暴露面。

---

## 3. Linux 常见风险面 (Review Points)

*   **定时与启动**：cron、systemd units、启动脚本、用户 shell profile。
*   **SSH 与账号**：authorized_keys、sshd_config、root 登录策略、弱口令与异常登录。
*   **应用层入口**：插件目录、上传目录、启动脚本与环境变量注入点（按业务特性梳理）。
*   **证据点**：文件权限/所有者、最近修改、登录与 sudo 审计日志、配置变更记录。

治理建议：
*   禁止不必要的 root 直登；强化 sudo 最小权限与审计。
*   文件完整性监控覆盖关键目录；收敛可写可执行路径。
*   集中化日志与告警闭环，确保异常变更能被发现并快速响应。

---

## 4. 容器与 K8s 风险面 (Review Points)

*   **供应链**：基础镜像、依赖、构建脚本与制品仓库的完整性与可追溯。
*   **集群对象**：CronJob、DaemonSet、RBAC、Webhook/Admission 等关键配置变更治理。
*   **节点访问**：节点与管理面访问控制、审计与告警。

治理建议：
*   准入策略与镜像签名；对高危配置执行阻断或强制审批。
*   RBAC 最小权限与命名空间隔离；对关键权限变更启用双人复核。
*   审计日志与告警闭环覆盖关键对象变更与特权工作负载。

---

## 5. 处置与复测 (Response & Verification)

*   处置：移除异常对象、回收权限、轮换凭据、确认无残留，并形成可追溯记录。
*   复测：基线对比 + 告警规则验证 + 变更审计回放，确保治理项长期有效。
